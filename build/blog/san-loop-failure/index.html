<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> SAN Loop Failure - micronauts </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Oops....fiber loop fiasco- SAN Loop Failure"> <meta name="keywords" content="SAN Loop Failure, micronauts, esx, vmware, netapp, storage, troubleshooting, vmware-kb,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="micronauts" property="og:site_name" /> <meta content="SAN Loop Failure" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Oops....fiber loop fiasco" property="og:description" /> <meta content="http://localhost:4000/blog/san-loop-failure/" property="og:url" /> <meta content="2011-08-02T00:00:00-04:00" property="article:published_time" /> <meta content="http://localhost:4000/about/" property="article:author" /> <meta content="http://localhost:4000/images/2011/08/100_0595-Small.jpg" property="og:image" /> <meta content="esx" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="SAN Loop Failure" /> <meta name="twitter:url" content="http://localhost:4000/blog/san-loop-failure/" /> <meta name="twitter:description" content="Oops....fiber loop fiasco" /> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://localhost:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://localhost:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://localhost:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://localhost:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://localhost:4000/assets/js/mode-switcher.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://localhost:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://localhost:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://localhost:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://localhost:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://localhost:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://localhost:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://localhost:4000/assets/js/search.js"></script> <script src="http://localhost:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">micronauts</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/gallery" >Gallery</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/styleguide"> Styleguide </a> </li> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">SAN Loop Failure</h1> <h4 class="post-meta">Oops....fiber loop fiasco</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://localhost:4000/blog/authors/samui">samui</a></span> </span > on <time datetime="2011-08-02 00:00:00 -0400" itemprop="datePublished" >Aug 2, 2011</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/san-loop-failure/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/esx" >esx</a > &nbsp; <a href="/blog/categories/vmware" >vmware</a > &nbsp; <a href="/blog/categories/netapp" >netapp</a > &nbsp; <a href="/blog/categories/storage" >storage</a > &nbsp; <a href="/blog/categories/troubleshooting" >troubleshooting</a > &nbsp; <a href="/blog/categories/vmware-kb" >vmware-kb</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="http://localhost:4000/images/2011/08/100_0595-Small.jpg" alt="" /> <br /> <br /> <p>Hereâ€™s an example of how important it is for your VMware Engineers to either have visibility into the SAN infrastructure, or work very intimately with the SAN Admins. We lost a fiber loop on one of our NetApp FAS 3160 SANs yesterday. If my team did not receive the critical fail-over emails, we would not have known that there were storage issues for a couple of vital hours.</p> <p>When your customers are complaining that there is something wrong with their VMs, or they have lost access to them; it is imperative to investigate and start troubleshooting. If we would have started troubleshooting without the knowledge of the SAN issue, then we would have started working on the VMs, which would have quickly led back to the ESX hosts they resided on. Troubleshooting the ESX hosts could have potentially made our outage A LOT worse.</p> <p>This particular environment consists of a virtual center 4.1 and eight ESX 4.01 U2 hosts. There happens to be a bug in ESX 4.XX that occurs when a rescan is issued while an all-paths-down state exists for any LUN in the vCenter Server cluster. Therefore, a virtual machine on one LUN stops responding (temporarily or permanently) because a different LUN in the vCenter Server cluster is in an all-paths-down state. (<a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1016626" target="_blank">Yeah, I cut and paste that from the VM KB, that you can read here</a>.) <em>The VM KB also mentions that the bug was fixed in ESX 4.1 U1.</em></p> <p>Since we were receiving the outage emails, we knew that something was up with our storage. This allowed us to work closely with our storage admins to understand the full extent of the outage.</p> <p>The details of our recovery goes something like this: A fail-over from Node A to Node B was made during the outage, however, Node B did not have access to the failed loop, therefore the aggregate on that loop was down. Node B carried the load for all other working aggregates giving our storage guys and the NetApp technician time to work on the loop. When repairs were completed, a fail-back (give-back) was done to allow Node A to take back over its share of the load. We confirmed with the NetApp tech that all paths and LUNs were represented to the ESX hosts. We then went in and rescanned each ESX host in the cluster for the ESX host to recognize the downed LUNs once more. After the scan, we viewed the properties of the LUN to ensure all paths were up. Once that was verified, we QAâ€™d our VMs. Of 45 affected VMs, we had one casualty. The VMX file of one VM got corrupted.</p> <p>The situation could have been worse, much worse. But Iâ€™m very glad that we stayed smart and calm and worked closely with our storage admins.</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="http://localhost:4000/blog/san-loop-failure/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Sam Aaron </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="http://localhost:4000/assets/img/authors/samui.png" alt="Sam Aaron" /> </div> <div class="col-md-6"> <p class="author_bio">Father, Husband, Geek. Workaholic.</p> <p>Email : mail@micronauts.us</p> <p>Website : http://micronauts.us</p> <p class="profile-links"> <a class="social-link" href="https://github.com/jedisamui" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/j.sam.aaron" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> </p> </div> </div> </div> </div> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "http://localhost:4000/blog/san-loop-failure/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/san-loop-failure"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Sam Aaron</div> <div class="card-body"> <p class="author_bio">Father. Husband. Geek. Workaholic.</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/sujaykundu777/devlopr-jekyll" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#esx"></div> <li class="tag-head"> <a href="/blog/categories/esx">esx</a> </li> <a name="esx"></a> <div id="#vmware"></div> <li class="tag-head"> <a href="/blog/categories/vmware">vmware</a> </li> <a name="vmware"></a> <div id="#linux"></div> <li class="tag-head"> <a href="/blog/categories/linux">linux</a> </li> <a name="linux"></a> <div id="#vmtools"></div> <li class="tag-head"> <a href="/blog/categories/vmtools">vmtools</a> </li> <a name="vmtools"></a> <div id="#p2v"></div> <li class="tag-head"> <a href="/blog/categories/p2v">p2v</a> </li> <a name="p2v"></a> <div id="#commandline"></div> <li class="tag-head"> <a href="/blog/categories/commandline">commandline</a> </li> <a name="commandline"></a> <div id="#vmnic"></div> <li class="tag-head"> <a href="/blog/categories/vmnic">vmnic</a> </li> <a name="vmnic"></a> <div id="#solaris"></div> <li class="tag-head"> <a href="/blog/categories/solaris">solaris</a> </li> <a name="solaris"></a> <div id="#ssh"></div> <li class="tag-head"> <a href="/blog/categories/ssh">ssh</a> </li> <a name="ssh"></a> <div id="#script"></div> <li class="tag-head"> <a href="/blog/categories/script">script</a> </li> <a name="script"></a> <div id="#daily"></div> <li class="tag-head"> <a href="/blog/categories/daily">daily</a> </li> <a name="daily"></a> <div id="#dos"></div> <li class="tag-head"> <a href="/blog/categories/dos">dos</a> </li> <a name="dos"></a> <div id="#lab"></div> <li class="tag-head"> <a href="/blog/categories/lab">lab</a> </li> <a name="lab"></a> <div id="#project"></div> <li class="tag-head"> <a href="/blog/categories/project">project</a> </li> <a name="project"></a> <div id="#network"></div> <li class="tag-head"> <a href="/blog/categories/network">network</a> </li> <a name="network"></a> <div id="#powercli"></div> <li class="tag-head"> <a href="/blog/categories/powercli">powercli</a> </li> <a name="powercli"></a> <div id="#troubleshooting"></div> <li class="tag-head"> <a href="/blog/categories/troubleshooting">troubleshooting</a> </li> <a name="troubleshooting"></a> <div id="#vcenter"></div> <li class="tag-head"> <a href="/blog/categories/vcenter">vcenter</a> </li> <a name="vcenter"></a> <div id="#windows"></div> <li class="tag-head"> <a href="/blog/categories/windows">windows</a> </li> <a name="windows"></a> <div id="#vmware-kb"></div> <li class="tag-head"> <a href="/blog/categories/vmware-kb">vmware-kb</a> </li> <a name="vmware-kb"></a> <div id="#howto"></div> <li class="tag-head"> <a href="/blog/categories/howto">howto</a> </li> <a name="howto"></a> <div id="#powershell"></div> <li class="tag-head"> <a href="/blog/categories/powershell">powershell</a> </li> <a name="powershell"></a> <div id="#storage"></div> <li class="tag-head"> <a href="/blog/categories/storage">storage</a> </li> <a name="storage"></a> <div id="#netapp"></div> <li class="tag-head"> <a href="/blog/categories/netapp">netapp</a> </li> <a name="netapp"></a> <div id="#tools"></div> <li class="tag-head"> <a href="/blog/categories/tools">tools</a> </li> <a name="tools"></a> <div id="#svmotion"></div> <li class="tag-head"> <a href="/blog/categories/svmotion">svmotion</a> </li> <a name="svmotion"></a> <div id="#vcloud"></div> <li class="tag-head"> <a href="/blog/categories/vcloud">vcloud</a> </li> <a name="vcloud"></a> <div id="#vra"></div> <li class="tag-head"> <a href="/blog/categories/vra">vra</a> </li> <a name="vra"></a> <div id="#automation"></div> <li class="tag-head"> <a href="/blog/categories/automation">automation</a> </li> <a name="automation"></a> <div id="#vcloud-director"></div> <li class="tag-head"> <a href="/blog/categories/vcloud-director">vcloud-director</a> </li> <a name="vcloud-director"></a> <div id="#tips"></div> <li class="tag-head"> <a href="/blog/categories/tips">tips</a> </li> <a name="tips"></a> <div id="#nsx"></div> <li class="tag-head"> <a href="/blog/categories/nsx">nsx</a> </li> <a name="nsx"></a> <div id="#jekyll"></div> <li class="tag-head"> <a href="/blog/categories/jekyll">jekyll</a> </li> <a name="jekyll"></a> <div id="#guides"></div> <li class="tag-head"> <a href="/blog/categories/guides">guides</a> </li> <a name="guides"></a> <div id="#sample_category"></div> <li class="tag-head"> <a href="/blog/categories/sample_category">sample_category</a> </li> <a name="sample_category"></a> <div id="#github"></div> <li class="tag-head"> <a href="/blog/categories/github">github</a> </li> <a name="github"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://localhost:4000/">Home</a> </li> <li> <a href="http://localhost:4000/about">About</a> </li> <li> <a href="http://localhost:4000/blog">Blog</a> </li> <li> <a href="http://localhost:4000/gallery">Gallery</a> </li> </div> </div> </div> </div> </div><footer> <p> Hosted with <a href="https://pages.github.com">Github Pages</a> </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
